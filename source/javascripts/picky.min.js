Array.prototype.index=function(a){for(var b=0,j=this.length;b<j;b++)if(this[b]==a)return b;return null};Array.prototype.include=function(a){return this.index(a)!==null};Array.prototype.remove=function(a){this.splice(a,1);return this};Array.prototype.compare=function(a){return this.join("")==a.join("")};Array.prototype.each=function(a){for(var b=0,j=this.length;b<j;b++)a(b,this[b]);return this};Array.prototype.map=function(a){for(var b=0,j=this.length;b<j;b++)this[b]=a(b,this[b]);return this};var dictionary={common:{join:{de:"und",fr:"et",it:"e",en:"and",ch:"und"},"with":{de:"mit",fr:"avec",it:"con",en:"with",ch:"mit"},of:{de:"von",fr:"de",it:"di",en:"of",ch:"vo"},to:{de:"bis",fr:"\u00e0",it:"alla",en:"to",ch:"bis"}},results:{addination:{more:{de:"Weitere Resultate",fr:"Autres r\u00e9sultats",it:"Altri risultati",en:"More results",ch:"Mee Resultaat"}},header:{de:"Ergebnisse",fr:"R\u00e9sultats",it:"Risultati",en:"Results",ch:"Erg\u00e4bnis"}}},t=function(a){for(var b=PickyI18n.locale||
"en",j=a.split(".").concat(b),k=dictionary,l=0,i=j.length;l<i;l++){k=k[j[l]];if(k==undefined){k="Translation missing: "+a+"."+b;break}}return k};function Allocation(a,b,j,k,l,i){var o=this;this.type=a;this.weight=b;this.count=j;this.combination=k;this.ids=l||[];this.entries=this.rendered=i||[];this.isType=function(r){return r==o.type}}function Allocations(a){this.allocations=[];for(var b=0,j=a.length;b<j;b++){var k=a[b];this.allocations.push(new Allocation(k[0],k[1],k[2],k[3],k[4],k[5]))}this.length=this.allocations.length;this.remove=function(l){this.allocations.splice(l,1)};this.each=function(l){this.allocations.each(l)}}
function PickyData(a){var b=a.total,j=a.duration,k=a.offset,l=new Allocations(a.allocations||[]);this.original_hash=a;this.total=b;this.duration=j;this.offset=k;this.allocations=l;this.renderedAmount=function(){var i=0;l.each(function(o,r){i+=r.rendered.length});return i};this.isEmpty=function(){return b==0}};var PickyView=function(a,b){var j=b.showResultsLimit||10,k=b.alwaysShowResults||false,l=b.alwaysShowSelection||false,i=b.input,o=b.reset,r=b.button,v=b.counter,x=b.form,u=b.moreSelector,w=b.results,g=b.noResults,e=new PickyAddination(this,w),h=new PickyAllocationsCloud(this,b),m=new PickyResultsRenderer(e,b),n=function(c){i.val(c);o.fadeTo(166,0);x.attr("class","empty");v.empty();h.hide();g.hide()};this.reset=n;var f=function(){return i.val()};this.text=f;var q=function(c){if(c.offset==0){w.empty();
m.render(w,c);w.show();i.focus()}else{var s=$(u).position().top;e.remove();m.render(w,c);$("body").animate({scrollTop:s-12},500)}},p=function(c){c>0&&c<=5&&v.fadeTo("fast",0.5).fadeTo("fast",1)},d=function(c){if(c.isEmpty())return"none";if(c.total>j&&c.allocations.length>1)return"support";return"ok"};this.insert=function(c){i.val(c);i.select()};this.fullResultsCallback=function(c){var s=d(c);x.attr("class",s);h.hide();g.hide();o.fadeTo(166,1);s=c.total;v.text(s);p(s);if(c.isEmpty()){w.empty();g.show()}else if(c.total>
j&&c.allocations.length>1){k&&q(c);h.show(c)}else{q(c);l&&h.show(c)}};this.liveResultsCallback=function(c){var s=d(c);x.attr("class",s);c=c.total;v.text(c);p(c)};this.allocationChosen=function(c){c=c.data.query;a.insert(c);a.allocationChosen(c)};this.addinationClicked=function(c){a.addinationClicked(f(),c)};(function(){i.keyup(function(c){if(f()==""){n();a.searchTextCleared()}else o.fadeTo(166,1);a.searchTextEntered(f(),c)});v.click(function(){a.searchButtonClicked(f())});r.click(function(){a.searchButtonClicked(f())});
o.click(function(){n();a.clearButtonClicked();i.focus()})})();i.focus()};var PickyBackend=function(a){var b=function(j,k,l){var i=l||{};i=$.extend({query:j},l);$.getJSON(a,i,function(o){k&&k(new PickyData(o))})};this.search=function(j,k,l,i){b(j,function(o){k&&k(i,o)},l)}},LiveBackend=function(a){var b=a.live||alert("A live backend path must be provided."),j=new PickyBackend(b);this.search=function(k,l,i,o){o=o||{};latestRequestTimestamp=new Date;o.live=latestRequestTimestamp;i=$.extend({ids:a.liveResults||0,offset:0},i);j.search(k,function(r,v){if(!r.live||r.live==latestRequestTimestamp)l&&
l(v,k)},i,o)}},FullBackend=function(a){var b=a.full||alert("A full backend path must be provided."),j=new PickyBackend(b);this.search=function(k,l,i,o){o=o||{};latestRequestTimestamp=new Date;o.full=latestRequestTimestamp;i=$.extend({ids:a.fullResults||20,offset:0},i);j.search(k,function(r,v){if(!r.full||r.full==latestRequestTimestamp)l&&l(v,k)},i,o)}};var PickyController=function(a){var b=new PickyView(this,a),j=a.backends,k=a.beforeInsert||function(d){return d},l=a.before||function(d){return d},i=a.success||function(d){return d},o=a.after||function(d){return d},r=a.searchOnEmpty||false,v=a.liveRendered||false,x=a.liveSearchInterval||180,u,w=function(d){return(d=d&&d.match(/q=([^&]+)/))&&decodeURIComponent(d[1]).replace(/\+/g," ").replace(/#/g,"")||""};this.extractQuery=w;var g=function(){var d=window.History&&window.History.getState();return w(d&&
d.url)};this.lastFullQuery=g;var e=function(d,c,s,y){var z=l(c,y);if(z!=undefined)c=z;u=[d,c,s,y];z=c;if(z!=g()){z=!r&&z==""?"":"?q="+escape(z).replace(/\*/g,"%2A");window.History&&window.History.getState()&&window.History.pushState&&window.History.pushState(null,null,z)}if(!r&&c=="")b.reset();else(d=j[d])&&d.search(c,s,y)};this.resend=function(){u&&e.apply(this,u)};var h=function(d,c){(d=i(d,c))&&b.fullResultsCallback(d);o(d,c)},m=function(d,c){clearInterval(f);e("full",d,h,c||{})};a=function(d,
c){(d=i(d,c))&&b.liveResultsCallback(d);o(d,c)};var n=v?h:a,f,q=function(){var d=b.text();e("live",d,n,{});clearInterval(f)};f=setInterval(q,x);clearInterval(f);var p=function(d,c,s){var y=k(d);if(y!=undefined)d=y;b.insert(d);s&&m(d,c)};this.insert=p;this.clearButtonClicked=function(){clearInterval(f)};this.searchTextCleared=function(){clearInterval(f)};this.searchTextEntered=function(d,c){if($.inArray(c.keyCode,[0,8,13,32,46,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,
79,80,81,82,83,84,85,86,87,88,89,90])>-1)if(c.keyCode==13)m(d);else{clearInterval(f);f=setInterval(q,x)}};this.searchButtonClicked=function(d){m(d)};this.allocationChosen=function(d){m(d)};this.addinationClicked=function(d,c){m(d,{offset:c.data.offset})};window.History&&window.History.Adapter.bind(window,"statechange",function(){var d=window.History.getState();d=w(d.url);d!=undefined&&d!=(u&&u.length>1&&u[1])&&p(d,{},true)})};var PickyI18n={},PickyClient=function(a){PickyI18n.locale=$("html").attr("lang").split("-")[0]||"en";a.locale=a.locale||PickyI18n.locale;a.qualifiers=a.qualifiers||{};a.explanations=a.explanations||{};a.choices=a.choices||{};a.explanation_delimiters={ch:"und",de:"und",en:"and",fr:"et",it:"e"};var b=a.backends;if(b){b.live||alert("Both a full and live backend must be provided.");b.full||alert("Both a full and live backend must be provided.")}else a.backends={live:new LiveBackend(a),full:new FullBackend(a)};
b=a.enclosingSelector||".picky";var j=a.formSelector||b+" form";a.form=$(j);a.input=$(a.inputSelector||j+" input[type=search]");a.reset=$(a.resetSelector||j+" div.reset");a.button=$(a.buttonSelector||j+" input[type=button]");a.counter=$(a.counterSelector||j+" div.status");a.results=$(a.resultsSelector||b+" div.results");a.noResults=$(a.noResultsSelector||b+" div.no_results");a.moreSelector=a.moreSelector||b+" div.results div.addination:last";a.allocations=$(a.allocationsSelector||b+" .allocations");
a.shownAllocations=$(a.shownAllocations||a.allocations.find(".shown"));a.showMoreAllocations=$(a.showMoreAllocations||a.allocations.find(".more"));a.hiddenAllocations=$(a.hiddenAllocations||a.allocations.find(".hidden"));a.maxSuggestions=a.maxSuggestions||3;a.results=$(a.resultsSelector||b+" div.results");a.resultsDivider=a.resultsDivider||"";a.nonPartial=a.nonPartial||[];a.wrapResults=a.wrapResults||"<ol></ol>";var k=a.controller&&new a.controller(a)||new PickyController(a);var l=this.insert=function(i,
o,r){k.insert(i,o||{},r||true)};this.resend=k.resend;this.insertFromURL=function(i){if(i)l(i);else(i=k.lastFullQuery())&&l(i)}};var PickyAddination=function(a,b){this.remove=function(){b.find(".addination").remove()};this.render=function(j){var k=j.total,l,i=j.renderedAmount();l=j.offset+i;i=l+i;j=j.total;if(j<i)i=j;l={offset:l,start:l+1,end:i};if(l.offset<k){k=$("<div class='addination'>"+t("results.addination.more")+"</div>");k.bind("click",{offset:l.offset},a.addinationClicked);return k}else return""}};var PickyResultsRenderer=function(a,b){var j=b.locale,k=b.explanations||{},l=b.explanation_delimiters||{},i=b.resultsDivider,o=b.wrapResults,r=b.nonPartial,v=function(e){var h=e[e.length-1];if(h===undefined)return[];e=e.slice(0,e.length-1);if(e==[])e=[e];if(!r.include(h[0]))if(h[1].match(/[^\*~]$/))h[1]+="*";e.push(h);return e};this.asteriskifyLastToken=v;var x=function(e){for(var h=k[j]||{},m=[],n,f=0,q=e.length;f<q;f++){n=e[f];var p=n[0];p=h[p]||p;m.push([p,n[1]])}return m};this.explainCategory=
x;var u=function(e,h){return["<strong>"+e+"</strong>",h].join(" ")};this.strongify=u;var w=function(e,h){var m=l[j],n="",f=[],q=[];x(v(h)).each(function(p,d){var c=d[0],s=d[1];s=s.replace(/[\w,]+:(.+)/,"$1");if(n==""||c==n){f.push(s);n=c}else{var y=u(n,f.join(" "));f=[];f.push(s);n=c;q.push(y)}});q.push(u(n,f.join(" ")));q=q.join(" "+m+" ");return q='<span class="explanation">'+e+" "+q+"</span>"};this.explain=w;var g=function(e,h){var m='<div class="header">';m+=w(h.type,h.combination);if(e.offset>
0)m+='<div class="tothetop"><a href="#" onclick="javascript:$(\'body\').animate({scrollTop: 0}, 500);">&uarr;</a></div>';m+="</div>";return m};this.renderHeader=g;this.render=function(e,h){h.allocations.each(function(m,n){if(n.entries.length>0){e.append(g(h,n)).append(n.entries.join(i));e.children("li").wrapAll(o)}});e.append(a.render(h))}};function AllocationRenderer(a){function b(g){var e={},h={},m={},n=[],f,q;f=0;for(q=g.length;f<q;f++){var p=g[f][0];if(p in e){e[p].push(g[f][1]);h[p].push(g[f][2]);n.push(f)}else{e[p]=[g[f][1]];h[p]=[g[f][2]];m[f]=p}}for(f in m){g[f][1]=e[m[f]];g[f][2]=h[m[f]]}for(f=n.length-1;f>=0;f--)g.remove(n[f]);return g}function j(g){g.map(function(e){return"%"+(e+1)+"$s"});return g.join(" ")}function k(g){if(g.length==0)return"";g=b(g);g.sort(function(p,d){return p[0]<d[0]?-1:1});for(var e=[],h=0,m=g.length;h<
m;h++)e.push(g[h][0]);var n=e.length==1,f=u[e.join(",")];if(f===undefined)f=u[e]=j(e);if(typeof f==="string"){u[e]={format:f,ignoreSingle:true};f=u[e]}var q=f.format;g.each(function(p,d){var c=d[0],s=d[1],y=d[2];y.map(function(z,A){var B=s[z];if(B.charAt(B.length-1)=="*")A+="...";return A});f.filter&&y.map(function(z,A){return f.filter(A)});if(n&&!(f&&f.ignoreSingle)){c=v[c]||c;return q=y.join("&nbsp;")+"&nbsp;("+c+")"}y.map(function(z,A){return A.replace(/[\w,]+:(.+)/,"$1")});q=q.replace(RegExp("%"+
(p+1)+"\\$s","g"),y.join("&nbsp;"))});return q}function l(g){for(var e=[],h=0,m=x.length;h<m;h++)e.push([]);e.push([]);h=0;for(m=g.length;h<m;h++){for(var n=g[h],f=n[0],q=false,p=0,d=x.length;p<d;p++)if(x[p].include(f)){e[p].push(n);q=true;break}q||e[e.length-1].push(n)}var c;for(g=e.length-1;g>=0;g--){c=e[g];if(c.length>0)break}c=c[c.length-1];w.include(c[0])||(c[1]=c[1].valueOf()+"*");return e}function i(g){var e=[];l(g).each(function(h,m){var n=k(m);n&&e.push(n)});return e.join(" ")}var o=a.locale,
r=a.qualifiers&&a.qualifiers[o]||{},v=a.explanations&&a.explanations[o]||{},x=a.groups||[],u=a.choices&&a.choices[o]||{},w=a.nonPartial||[];this.explanation=this.query=this.text="";this.contract=b;this.makeUpMissingFormat=j;this.rendered=k;this.groupify=l;this.querify=function(g){var e=[],h,m,n;for(n in g){h=g[n][0];h=r[h]||h;m=(m=g[n][1])||"";m=m.charAt(m.length-1)=="*"?"*":"";e[n]=h+":"+g[n][2]+m}return e.join(" ")};this.suggestify=i;this.render=function(g){return i(g.combination)}};var PickyAllocationsCloud=function(a,b){var j=b.allocations,k=b.shownAllocations,l=b.showMoreAllocations,i=b.hiddenAllocations,o=b.maxSuggestions,r=function(){j.hide()},v=function(g){r();a.allocationChosen(g)},x=new AllocationRenderer(b),u=function(g){var e=[];g.each(function(h,m){var n=x.querify(m.combination),f=x.render(m);f=$('<li><div class="text">'+f+'</div><div class="count">'+m.count+"</div></li>");f.bind("click",{query:n},v);e.push(f)});return e},w=function(g){if(g.length==0)return j.hide();
k.empty();l.hide();i.empty().hide();if(g.length>o){$.each(g.slice(0,o-1),function(e,h){k.append(h)});$.each(g.slice(o-1),function(e,h){i.append(h)});l.show()}else $.each(g,function(e,h){k.append(h)});return j.show()};l.click(function(){l.hide();i.show()});this.hide=r;this.show=function(g){w(u(g.allocations));j.show()}};
