Array.prototype.index=function(a){for(var b=0,i=this.length;b<i;b++)if(this[b]==a)return b;return null};Array.prototype.include=function(a){return this.index(a)!==null};Array.prototype.remove=function(a){this.splice(a,1);return this};Array.prototype.compare=function(a){return this.join("")==a.join("")};Array.prototype.each=function(a){for(var b=0,i=this.length;b<i;b++)a(b,this[b]);return this};Array.prototype.map=function(a){for(var b=0,i=this.length;b<i;b++)this[b]=a(b,this[b]);return this};var dictionary={common:{join:{de:"und",fr:"et",it:"e",en:"and",ch:"und"},"with":{de:"mit",fr:"avec",it:"con",en:"with",ch:"mit"},of:{de:"von",fr:"de",it:"di",en:"of",ch:"vo"},to:{de:"bis",fr:"\u00e0",it:"alla",en:"to",ch:"bis"}},results:{addination:{more:{de:"Weitere Resultate",fr:"Autres r\u00e9sultats",it:"Altri risultati",en:"More results",ch:"Mee Resultaat"}},header:{de:"Ergebnisse",fr:"R\u00e9sultats",it:"Risultati",en:"Results",ch:"Erg\u00e4bnis"}}},t=function(a){for(var b=PickyI18n.locale||
"en",i=a.split(".").concat(b),j=dictionary,k=0,g=i.length;k<g;k++){j=j[i[k]];if(j==undefined){j="Translation missing: "+a+"."+b;break}}return j};function Allocation(a,b,i,j,k,g){var p=this;this.type=a;this.weight=b;this.count=i;this.combination=j;this.ids=k||[];this.entries=this.rendered=g||[];this.isType=function(s){return s==p.type}}function Allocations(a){this.allocations=[];for(var b=0,i=a.length;b<i;b++){var j=a[b];this.allocations.push(new Allocation(j[0],j[1],j[2],j[3],j[4],j[5]))}this.length=this.allocations.length;this.remove=function(k){this.allocations.splice(k,1)};this.each=function(k){this.allocations.each(k)}}
function PickyData(a){var b=a.total,i=a.duration,j=a.offset,k=new Allocations(a.allocations||[]);this.original_hash=a;this.total=b;this.duration=i;this.offset=j;this.allocations=k;this.renderedAmount=function(){var g=0;k.each(function(p,s){g+=s.rendered.length});return g};this.isEmpty=function(){return b==0}};var PickyView=function(a,b){var i=b.showResultsLimit||10,j=b.alwaysShowResults||false,k=b.alwaysShowSelection||false,g=b.input,p=b.reset,s=b.button,x=b.counter,y=b.form,v=b.moreSelector,w=b.results,f=b.noResults,c=new PickyAddination(this,w),h=new PickyAllocationsCloud(this,b),m=new PickyResultsRenderer(c,b),n=function(){p.fadeTo(166,1)},e=function(){h.hide();w.empty();f.hide()},r=function(l){g.val(l);p.fadeTo(166,0);y.attr("class","empty");x.empty();e()};this.reset=r;var q=function(){return g.val()};
this.text=q;var d=function(l){x.text(l);l>0&&l<=5&&x.fadeTo("fast",0.5).fadeTo("fast",1)},o=function(l){if(l.isEmpty())return"none";if(l.total>i&&l.allocations.length>1)return"support";return"ok"};this.insert=function(l){g.val(l);g.select()};this.fullResultsCallback=function(l){var u=o(l);y.attr("class",u);if(l.isEmpty()){e();d(0);f.show();n()}else if(l.total>i&&l.allocations.length>1){e();n();d(l.total);if(j){m.render(w,l);w.show()}h.show(l)}else if(l.offset==0){e();n();d(l.total);m.render(w,l);
w.show();k&&h.show(l);g.focus()}else{u=$(v).position().top;c.remove();m.render(w,l);$("body").animate({scrollTop:u-12},500)}};this.liveResultsCallback=function(l){var u=o(l);y.attr("class",u);d(l.total)};this.allocationChosen=function(l){l=l.data.query;a.insert(l);a.allocationChosen(l)};this.addinationClicked=function(l){a.addinationClicked(q(),l)};(function(){g.keyup(function(l){if(q()==""){r();a.searchTextCleared()}else n();a.searchTextEntered(q(),l)});x.click(function(){a.searchButtonClicked(q())});
s.click(function(){a.searchButtonClicked(q())});p.click(function(){r();a.clearButtonClicked();g.focus()})})();g.focus()};var PickyBackend=function(a){var b=function(i,j,k){var g=k||{};g=$.extend({query:i},k);$.getJSON(a,g,function(p){j&&j(new PickyData(p))})};this.search=function(i,j,k,g){b(i,function(p){j&&j(g,p)},k)}},LiveBackend=function(a){var b=a.live||alert("A live backend path must be provided."),i=new PickyBackend(b);this.search=function(j,k,g,p){p=p||{};latestRequestTimestamp=new Date;p.live=latestRequestTimestamp;g=$.extend({ids:a.liveResults||0,offset:0},g);i.search(j,function(s,x){if(!s.live||s.live==latestRequestTimestamp)k&&
k(x)},g,p)}},FullBackend=function(a){var b=a.full||alert("A full backend path must be provided."),i=new PickyBackend(b);this.search=function(j,k,g,p){p=p||{};latestRequestTimestamp=new Date;p.full=latestRequestTimestamp;g=$.extend({ids:a.fullResults||20,offset:0},g);i.search(j,function(s,x){if(!s.full||s.full==latestRequestTimestamp)k&&k(x)},g,p)}};var PickyController=function(a){var b=new PickyView(this,a),i=a.backends,j=a.beforeInsert||function(){},k=a.before||function(){},g=a.success||function(){},p=a.after||function(){},s=a.searchOnEmpty||false,x=a.liveRendered||false,y=a.liveSearchInterval||180,v,w=function(d){return(d=d&&d.match(/q=([^&]+)/))&&decodeURIComponent(d[1]).replace(/\+/g," ").replace(/#/g,"")||""};this.extractQuery=w;var f=function(){var d=window.History&&window.History.getState();return w(d&&d.url)};this.lastFullQuery=f;var c=
function(d,o,l,u){var z=k(o,u);if(z!=undefined)o=z;v=[d,o,l,u];z=o;if(z!=f()){z=!s&&z==""?"":"?q="+escape(z).replace(/\*/g,"%2A");window.History&&window.History.getState()&&window.History.pushState&&window.History.pushState(null,null,z)}if(!s&&o=="")b.reset();else(d=i[d])&&d.search(o,l,u)};this.resend=function(){v&&c.apply(this,v)};var h=function(d,o){d=g(d,o)||d;b.fullResultsCallback(d);p(d,o)},m=function(d,o){clearInterval(e);c("full",d,h,o||{})};a=function(d,o){d=g(d,o)||d;b.liveResultsCallback(d);
p(d,o)};var n=x?h:a,e,r=function(){var d=b.text();c("live",d,n,{});clearInterval(e)};e=setInterval(r,y);clearInterval(e);var q=function(d,o,l){var u=j(d);if(u!=undefined)d=u;b.insert(d);l&&m(d,o)};this.insert=q;this.clearButtonClicked=function(){clearInterval(e)};this.searchTextCleared=function(){clearInterval(e)};this.searchTextEntered=function(d,o){if($.inArray(o.keyCode,[0,8,13,32,46,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90])>-1)if(o.keyCode==
13)m(d);else{clearInterval(e);e=setInterval(r,y)}};this.searchButtonClicked=function(d){m(d)};this.allocationChosen=function(d){m(d)};this.addinationClicked=function(d,o){m(d,{offset:o.data.offset})};window.History&&window.History.Adapter.bind(window,"statechange",function(){var d=window.History.getState();d=w(d.url);d!=undefined&&d!=(v&&v.length>1&&v[1])&&q(d,{},true)})};var PickyI18n={},PickyClient=function(a){PickyI18n.locale=$("html").attr("lang").split("-")[0]||"en";a.locale=a.locale||PickyI18n.locale;a.qualifiers=a.qualifiers||{};a.explanations=a.explanations||{};a.choices=a.choices||{};a.explanation_delimiters={ch:"und",de:"und",en:"and",fr:"et",it:"e"};var b=a.backends;if(b){b.live||alert("Both a full and live backend must be provided.");b.full||alert("Both a full and live backend must be provided.")}else a.backends={live:new LiveBackend(a),full:new FullBackend(a)};
b=a.enclosingSelector||".picky";var i=a.formSelector||b+" form";a.form=$(i);a.input=$(a.inputSelector||i+" input[type=search]");a.reset=$(a.resetSelector||i+" div.reset");a.button=$(a.buttonSelector||i+" input[type=button]");a.counter=$(a.counterSelector||i+" div.status");a.results=$(a.resultsSelector||b+" div.results");a.noResults=$(a.noResultsSelector||b+" div.no_results");a.moreSelector=a.moreSelector||b+" div.results div.addination:last";a.allocations=$(a.allocationsSelector||b+" .allocations");
a.shownAllocations=a.allocations.find(".shown");a.showMoreAllocations=a.allocations.find(".more");a.hiddenAllocations=a.allocations.find(".hidden");a.maxSuggestions=a.maxSuggestions||3;a.results=$(a.resultsSelector||b+" div.results");a.resultsDivider=a.resultsDivider||"";a.nonPartial=a.nonPartial||[];a.wrapResults=a.wrapResults||"<ol></ol>";var j=a.controller&&new a.controller(a)||new PickyController(a);var k=this.insert=function(g,p,s){j.insert(g,p||{},s||true)};this.resend=j.resend;this.insertFromURL=
function(g){if(g)k(g);else(g=j.lastFullQuery())&&k(g)}};var PickyAddination=function(a,b){this.remove=function(){b.find(".addination").remove()};this.render=function(i){var j=i.total,k,g=i.renderedAmount();k=i.offset+g;g=k+g;i=i.total;if(i<g)g=i;k={offset:k,start:k+1,end:g};if(k.offset<j){j=$("<div class='addination'>"+t("results.addination.more")+"</div>");j.bind("click",{offset:k.offset},a.addinationClicked);return j}else return""}};var PickyResultsRenderer=function(a,b){var i=b.locale,j=b.explanations||{},k=b.explanation_delimiters||{},g=b.resultsDivider,p=b.wrapResults,s=b.nonPartial,x=function(c){var h=c[c.length-1];if(h===undefined)return[];c=c.slice(0,c.length-1);if(c==[])c=[c];if(!s.include(h[0]))if(h[1].match(/[^\*~]$/))h[1]+="*";c.push(h);return c};this.asteriskifyLastToken=x;var y=function(c){for(var h=j[i]||{},m=[],n,e=0,r=c.length;e<r;e++){n=c[e];var q=n[0];q=h[q]||q;m.push([q,n[1]])}return m};this.explainCategory=
y;var v=function(c,h){return["<strong>"+c+"</strong>",h].join(" ")};this.strongify=v;var w=function(c,h){var m=k[i],n="",e=[],r=[];y(x(h)).each(function(q,d){var o=d[0],l=d[1];l=l.replace(/[\w,]+:(.+)/,"$1");if(n==""||o==n){e.push(l);n=o}else{var u=v(n,e.join(" "));e=[];e.push(l);n=o;r.push(u)}});r.push(v(n,e.join(" ")));r=r.join(" "+m+" ");return r='<span class="explanation">'+c+" "+r+"</span>"};this.explain=w;var f=function(c,h){var m='<div class="header">';m+=w(h.type,h.combination);if(c.offset>
0)m+='<div class="tothetop"><a href="#" onclick="javascript:$(\'body\').animate({scrollTop: 0}, 500);">&uarr;</a></div>';m+="</div>";return m};this.renderHeader=f;this.render=function(c,h){h.allocations.each(function(m,n){if(n.entries.length>0){c.append(f(h,n)).append(n.entries.join(g));c.children("li").wrapAll(p)}});c.append(a.render(h))}};function AllocationRenderer(a){function b(f){var c={},h={},m={},n=[],e,r;e=0;for(r=f.length;e<r;e++){var q=f[e][0];if(q in c){c[q].push(f[e][1]);h[q].push(f[e][2]);n.push(e)}else{c[q]=[f[e][1]];h[q]=[f[e][2]];m[e]=q}}for(e in m){f[e][1]=c[m[e]];f[e][2]=h[m[e]]}for(e=n.length-1;e>=0;e--)f.remove(n[e]);return f}function i(f){f.map(function(c){return"%"+(c+1)+"$s"});return f.join(" ")}function j(f){if(f.length==0)return"";f=b(f);f.sort(function(q,d){return q[0]<d[0]?-1:1});for(var c=[],h=0,m=f.length;h<
m;h++)c.push(f[h][0]);var n=c.length==1,e=v[c.join(",")];if(e===undefined)e=v[c]=i(c);if(typeof e==="string"){v[c]={format:e,ignoreSingle:true};e=v[c]}var r=e.format;f.each(function(q,d){var o=d[0],l=d[1],u=d[2];u.map(function(z,A){var B=l[z];if(B.charAt(B.length-1)=="*")A+="...";return A});e.filter&&u.map(function(z,A){return e.filter(A)});if(n&&!(e&&e.ignoreSingle)){o=x[o]||o;return r=u.join("&nbsp;")+"&nbsp;("+o+")"}u.map(function(z,A){return A.replace(/[\w,]+:(.+)/,"$1")});r=r.replace(RegExp("%"+
(q+1)+"\\$s","g"),u.join("&nbsp;"))});return r}function k(f){for(var c=[],h=0,m=y.length;h<m;h++)c.push([]);c.push([]);h=0;for(m=f.length;h<m;h++){for(var n=f[h],e=n[0],r=false,q=0,d=y.length;q<d;q++)if(y[q].include(e)){c[q].push(n);r=true;break}r||c[c.length-1].push(n)}var o;for(f=c.length-1;f>=0;f--){o=c[f];if(o.length>0)break}o=o[o.length-1];w.include(o[0])||(o[1]=o[1].valueOf()+"*");return c}function g(f){var c=[];k(f).each(function(h,m){var n=j(m);n&&c.push(n)});return c.join(" ")}var p=a.locale,
s=a.qualifiers&&a.qualifiers[p]||{},x=a.explanations&&a.explanations[p]||{},y=a.groups||[],v=a.choices&&a.choices[p]||{},w=a.nonPartial||[];this.explanation=this.query=this.text="";this.contract=b;this.makeUpMissingFormat=i;this.rendered=j;this.groupify=k;this.querify=function(f){var c=[],h,m,n;for(n in f){h=f[n][0];h=s[h]||h;m=(m=f[n][1])||"";m=m.charAt(m.length-1)=="*"?"*":"";c[n]=h+":"+f[n][2]+m}return c.join(" ")};this.suggestify=g;this.render=function(f){return g(f.combination)}};var PickyAllocationsCloud=function(a,b){var i=b.allocations,j=b.shownAllocations,k=b.showMoreAllocations,g=b.hiddenAllocations,p=b.maxSuggestions,s=function(){i.hide()},x=function(f){s();a.allocationChosen(f)},y=new AllocationRenderer(b),v=function(f){var c=[];f.each(function(h,m){var n=y.querify(m.combination),e=y.render(m);e=$('<li><div class="text">'+e+'</div><div class="count">'+m.count+"</div></li>");e.bind("click",{query:n},x);c.push(e)});return c},w=function(f){if(f.length==0)return i.hide();
j.empty();k.hide();g.empty().hide();if(f.length>p){$.each(f.slice(0,p-1),function(c,h){j.append(h)});$.each(f.slice(p-1),function(c,h){g.append(h)});k.show()}else $.each(f,function(c,h){j.append(h)});return i.show()};k.click(function(){k.hide();g.show()});this.hide=s;this.show=function(f){w(v(f.allocations));i.show()}};
